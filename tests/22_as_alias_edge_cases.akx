(io/putf "=== Testing :as Alias Edge Cases ===\n")
(io/putf "\n")

(io/putf "Test 1: Loading same builtin with different symbols\n")
(cjit-load-builtin add :root "nucleus/math/add.c")
(cjit-load-builtin + :root "nucleus/math/add.c" :as "add")
(let sum1 (add 1 2))
(let sum2 (+ 3 4))
(io/putf "  add 1 2 = %d\n" sum1)
(io/putf "  + 3 4 = %d\n" sum2)
(assert-eq sum1 3 "add without alias should work")
(assert-eq sum2 7 "+ with alias should work")

(io/putf "Test 2: Reloading builtin with :as\n")
(cjit-load-builtin + :root "nucleus/math/add.c" :as "add")
(let sum3 (+ 5 6))
(io/putf "  + 5 6 (reloaded) = %d\n" sum3)
(assert-eq sum3 11 "reloaded + should still work")

(io/putf "Test 3: Using :as with regular names\n")
(cjit-load-builtin myprint :root "nucleus/io/putf.c" :as "putf_impl")
(myprint "  Custom aliased putf works!\n")

(io/putf "Test 4: Mixing aliased and non-aliased builtins\n")
(cjit-load-builtin - :root "nucleus/math/sub.c" :as "sub")
(let diff (- 20 (add 3 4)))
(io/putf "  - 20 (add 3 4) = %d\n" diff)
(assert-eq diff 13 "mixed builtins should work together")

(io/putf "\n")
(io/putf "All edge case tests passed!\n")

