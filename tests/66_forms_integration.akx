(io/putf "=== Forms Integration Tests ===\n")

(io/putf "Test 1: Nested compound forms\n")
(form/define :Inner { :int :int })
(form/define :Outer { :Inner :string })
(io/putf "  PASS: Nested compound forms defined\n")

(io/putf "Test 2: Configuration with optional fields\n")
(form/define :Port (optional :int))
(form/define :Config [:host :string :port :Port])
(io/putf "  PASS: Config with optional port defined\n")

(io/putf "Test 3: Document with tags\n")
(form/define :TagList (repeatable :string))
(form/define :Document [:title :string :tags :TagList])
(io/putf "  PASS: Document with repeatable tags defined\n")

(io/putf "Test 4: List of integers\n")
(form/define :IntList (list :int))
(io/putf "  PASS: List of integers defined\n")

(io/putf "Test 5: Complex struct\n")
(form/define :Address [:street :string :city :string :zip :int])
(form/define :Person [:name :string :age :int :addr :Address])
(io/putf "  PASS: Nested struct forms defined\n")

(io/putf "Test 6: Multiple affordances on one form\n")
(form/define :Counter :int)
(form/add-affordance :Counter :inc (lambda [x] (+ x 1)))
(form/add-affordance :Counter :dec (lambda [x] (- x 1)))
(form/add-affordance :Counter :double (lambda [x] (* x 2)))
(io/putf "  PASS: Multiple affordances added\n")

(io/putf "Test 7: Affordances on different forms\n")
(form/define :Temp :real)
(form/add-affordance :Temp :to-f (lambda [c] (+ (* c 1.8) 32)))
(form/define :Distance :real)
(form/add-affordance :Distance :to-km (lambda [m] (/ m 1000.0)))
(io/putf "  PASS: Different forms with affordances\n")

(io/putf "Test 8: Domain modeling\n")
(form/define :Width :int)
(form/define :Height :int)
(form/define :Dimensions { :Width :Height })
(let w 100)
(let h 200)
(if (and (form/matches w :Width) (form/matches h :Height))
  (io/putf "  PASS: Domain types validated\n")
  (io/putf "  FAIL: Domain types should validate\n"))

(io/putf "Test 9: Optional list combination\n")
(form/define :NumList (list :int))
(form/define :OptNumList (optional :NumList))
(io/putf "  PASS: Optional list combination defined\n")

(io/putf "Test 10: Repeatable struct\n")
(form/define :Item [:id :int :name :string])
(form/define :Items (repeatable :Item))
(io/putf "  PASS: Repeatable struct defined\n")

(io/putf "\n=== All Integration Tests Complete ===\n")

